# invoice-payment-date-checker（Excel 憑單合併與預計付款日檢查工具）

這個專案是使用 Python 實作的 **Excel 憑單合併與「預計付款日」自動計算／比對工具**，  
搭配統計圖表與錯誤紀錄，協助會計或財務人員加速月結作業。

主要由四支腳本組成：

- `merge_all_data.py`：合併多個憑單 Excel 檔
- `compare.py`：依付款條件計算「預計付款日」，並與系統日期比對
- `Pie_Chart.py`：根據合併結果產生統計圖表（例如圓餅圖）
- `excel_error_log.py`：處理 Excel 修復訊息與錯誤紀錄

---

## 功能特色

- ✅ 自動掃描資料夾中的全部憑單 Excel 檔並合併
- ✅ 自動偵測表頭列（包含 `憑單日期、憑單單號、廠商簡稱、付款條件名稱…`）
- ✅ 支援多種欄位名稱格式（`憑單日期 / 憑單日 / 憑單日期(西元)` 等）
- ✅ 依「付款條件名稱」自動計算預計付款日（例如：當月 18 號付款、次月 15 號付款）
- ✅ 產出：
  - 合併總表：`TOTAL_YYYYMMDD_HHMM.xlsx`
  - 不一致明細：系統預計付款日 vs 程式計算日期＋相差天數
- ✅ 額外產出統計圖表（圓餅圖等），直接嵌入 Excel
- ✅ 清理不合法字元、紀錄 Excel 修復錯誤，避免開啟時跳出「部分內容有問題」

---

## 專案結構

```text
Data processing/
├─ merge_all_data.py   # 合併多個 Excel 憑單檔，產生 TOTAL_YYYYMMDD_HHMM.xlsx
├─ compare.py          # 依付款條件計算預計付款日，產出不一致明細
├─ Pie_Chart.py        # 對合併結果做統計，產生圓餅圖並嵌入 Excel
├─ excel_error_log.py  # 處理 Excel 錯誤／修復訊息的輔助工具（選用）
└─ README.md           # 專案說明（本檔案）

---

主要檔案說明
merge_all_data.py

掃描指定資料夾中的所有憑單 Excel 檔（支援 .xlsx / .xls）

自動尋找「表頭列」，包含：

憑單日期、憑單單號、廠商代號、廠商簡稱、付款條件代號、付款條件名稱…

將不同檔案、不同工作表中的資料合併成一張總表

處理不同日期欄位名稱：

憑單日期 / 憑單日 / 憑單日期(西元) 統一輸出為同一欄位

統一日期格式（例如：yyyy/mm/dd）

自動調整欄寬、清理不合法 XML 字元，避免 Excel 開啟時出現修復訊息

輸出檔名格式類似：

TOTAL_YYYYMMDD_HHMM.xlsx

compare.py

輸入：由 merge_all_data.py 產出的 TOTAL_*.xlsx

依每筆紀錄的：

單據日期（憑單日期）

廠商名稱（例如：南科管理局）

付款條件名稱（例如：當月 18 號付款、次月 15 號付款）
計算「預計付款日」

付款條件規則範例：

當月 18 號付款

單據日期 ≤ 18 號 → 預計付款日 = 當月 18 號

單據日期 > 18 號 → 預計付款日 = 次月 18 號

次月 15 號付款（南科管理局）

不論單據日期幾號 → 預計付款日 = 次月 15 號

與系統中的「預計付款日」欄位比對：

計算差異天數

註記「計算依據」（使用哪一條付款條件規則）

輸出「不一致明細」報表，欄位類似：

憑單單號、單據日期、廠商代號、廠商簡稱、付款條件代號、付款條件名稱、預計付款日、系統預計付款日(顯示)、相差天數、計算依據

Pie_Chart.py

讀取合併後的總表或特定統計用 Excel

使用 pandas 進行聚合統計，例如：

依廠商、付款條件、費用類別統計金額

使用 matplotlib 繪製：

圓餅圖（Pie Chart）

或其他簡單統計圖表

使用 openpyxl 將圖表嵌入到指定的 Excel 工作表中

方便直接把統計結果報告給主管或同事，不需要再手動拉圖表

excel_error_log.py

處理 Excel 開啟時可能出現的「部分內容有問題」錯誤情境

可用來：

分析錯誤的 XML log

協助找出是哪一筆資料含有不合法字元

清理或記錄錯誤欄位，方便之後修正輸入資料

此檔視需求使用，主要作為偵錯／除錯工具
